<mat-card>
    <mat-card-content>
        <div class="actions" [class.accent]="selection.selected.length" fxLayout="row">
            <div fxFlex>
                <div class="selected-orders" *ngIf="selection.selected.length" i18n>
                    {{selection.selected.length}} {selection.selected.length, plural, =1 {order} other {orders}}
                    selected
                </div>
            </div>
            <div *ngIf="!isLoadingResults && dataSource.data.length">
                <sf-status-buttons [status]="ordersFilter.status"
                                   [acknowledgment]="ordersFilter.acknowledgment"
                                   [errorType]="ordersFilter.error"
                                   (actionApplied)="applyStatusAction($event)">
                </sf-status-buttons>
            </div>
            <button mat-icon-button (click)="manageTags()">
                <mat-icon>label</mat-icon>
            </button>
            <button mat-icon-button [matMenuTriggerFor]="printMenu" *ngIf="selection.selected.length"
                    class="print-button">
                <mat-icon>local_printshop</mat-icon>
            </button>
            <button mat-icon-button (click)="showSelectOrdersDialog()" *ngIf="!selection.selected.length"
                    class="print-button">
                <mat-icon>local_printshop</mat-icon>
            </button>
            <button mat-icon-button [matMenuTriggerFor]="columnsMenu">
                <mat-icon>view_column</mat-icon>
            </button>
        </div>
        <div [class.table-container]="isLoadingResults" class="table-scrollable">
            <div *ngIf="isLoadingResults">
                <mat-progress-bar mode="indeterminate" color="accent"></mat-progress-bar>
            </div>


            <table mat-table [dataSource]="dataSource">

                <ng-container matColumnDef="checkbox">
                    <th mat-header-cell *matHeaderCellDef>
                        <mat-checkbox (click)="$event.stopPropagation()"
                                      (change)="$event ? masterToggle() : null"
                                      [checked]="selection.hasValue() && isAllSelected()"
                                      [indeterminate]="selection.hasValue() && !isAllSelected()"></mat-checkbox>
                    </th>
                    <td mat-cell *matCellDef="let row">
                        <mat-checkbox (click)="$event.stopPropagation()"
                                      (change)="$event ? selection.toggle(row) : null"
                                      [checked]="selection.isSelected(row)"></mat-checkbox>
                    </td>
                </ng-container>

                <ng-container matColumnDef="tags">
                    <th mat-header-cell  *matHeaderCellDef></th>
                    <td mat-cell  *matCellDef="let row">
                        <mat-chip-list classs="sf-tags-chips">
                            <mat-chip *ngFor="let tag of row.tags" color="accent" [selected]="true">{{tag.name}}</mat-chip>
                        </mat-chip-list>
                    </td>
                </ng-container>

                <ng-container matColumnDef="hasErrors">
                    <th mat-header-cell *matHeaderCellDef></th>
                    <td mat-cell *matCellDef="let row">
                        <mat-icon *ngIf="row.hasErrors" color="warn">error</mat-icon>
                    </td>
                </ng-container>

                <ng-container matColumnDef="marketplace">
                    <th mat-header-cell *matHeaderCellDef> Marketplace</th>
                    <td mat-cell *matCellDef="let row">
                        <img [src]="row.channelImage" class="marketplace-logo" width="65">
                    </td>
                </ng-container>

                <ng-container matColumnDef="reference">
                    <th mat-header-cell *matHeaderCellDef> Id</th>
                    <td mat-cell *matCellDef="let row"> {{row.reference}}</td>
                </ng-container>

                <ng-container matColumnDef="status">
                    <th mat-header-cell *matHeaderCellDef> Status</th>
                    <td mat-cell *matCellDef="let row">
                        <sf-order-status [status]="row.status"></sf-order-status>
                    </td>
                </ng-container>

                <ng-container matColumnDef="total">
                    <th mat-header-cell *matHeaderCellDef> Total</th>
                    <td mat-cell *matCellDef="let row"> {{row.total | sfCurrency:row.currency}}</td>
                </ng-container>

                <ng-container matColumnDef="date">
                    <th mat-header-cell *matHeaderCellDef> Date</th>
                    <td mat-cell *matCellDef="let row"> {{row.date | date:'short'}}</td>
                </ng-container>
                <ng-container matColumnDef="updatedAt">
                    <th mat-header-cell *matHeaderCellDef> Updated at</th>
                    <td mat-cell *matCellDef="let row"> {{row.updatedAt | date:'short'}}</td>
                </ng-container>
                <ng-container matColumnDef="productAmount">
                    <th mat-header-cell *matHeaderCellDef> Product amount</th>
                    <td mat-cell *matCellDef="let row"> {{row.productAmount | sfCurrency:row.currency}}</td>
                </ng-container>
                <ng-container matColumnDef="shippingAmount">
                    <th mat-header-cell *matHeaderCellDef> Shipping amount</th>
                    <td mat-cell *matCellDef="let row"> {{row.shippingAmount | sfCurrency:row.currency}}</td>
                </ng-container>
                <ng-container matColumnDef="paymentMethod">
                    <th mat-header-cell *matHeaderCellDef> Payment Method</th>
                    <td mat-cell *matCellDef="let row"> {{row.paymentMethod}}</td>
                </ng-container>
                <ng-container matColumnDef="deliveryName">
                    <th mat-header-cell *matHeaderCellDef> Delivery Name</th>
                    <td mat-cell *matCellDef="let row"> {{row.deliveryName}}</td>
                </ng-container>
                <ng-container matColumnDef="invoicingName">
                    <th mat-header-cell *matHeaderCellDef> Billing Name</th>
                    <td mat-cell *matCellDef="let row"> {{row.invoicingName}}</td>
                </ng-container>
                <ng-container matColumnDef="storeId">
                    <th mat-header-cell *matHeaderCellDef> Store Reference</th>
                    <td mat-cell *matCellDef="let row"> {{row.storeId}}</td>
                </ng-container>
                <ng-container matColumnDef="trackingNumber">
                    <th mat-header-cell *matHeaderCellDef> Tracking Number</th>
                    <td mat-cell *matCellDef="let row"> {{row.trackingNumber}}</td>
                </ng-container>
                <ng-container matColumnDef="imported">
                    <th mat-header-cell *matHeaderCellDef> Acknowledged</th>
                    <td mat-cell *matCellDef="let row">
                        <span *ngIf="row.imported" i18n>Yes</span>
                        <span *ngIf="!row.imported" i18n>No</span>
                    </td>
                </ng-container>
                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns;" (click)="goToOrder(row.id)">{{row.name}}
                </tr>
            </table>
            <div class="no-orders-message" i18n *ngIf="!isLoadingResults && !dataSource.data.length">
                No orders matching your request.
            </div>
        </div>
        <mat-paginator [pageSize]="10" [length]="resultsLength"></mat-paginator>
    </mat-card-content>
</mat-card>

<mat-menu #columnsMenu="matMenu" (closed)="setDisplayedColumns()">
    <div mat-menu-item>
        <mat-checkbox (click)="$event.stopPropagation()" [(ngModel)]="optionalColumns.updatedAt">Updated at
        </mat-checkbox>
    </div>
    <div mat-menu-item>
        <mat-checkbox (click)="$event.stopPropagation()" [(ngModel)]="optionalColumns.productAmount">Product amount
        </mat-checkbox>
    </div>
    <div mat-menu-item>
        <mat-checkbox (click)="$event.stopPropagation()" [(ngModel)]="optionalColumns.shippingAmount">Shipping amount
        </mat-checkbox>
    </div>
    <div mat-menu-item>
        <mat-checkbox (click)="$event.stopPropagation()" [(ngModel)]="optionalColumns.paymentMethod">Payment method
        </mat-checkbox>
    </div>
    <div mat-menu-item>
        <mat-checkbox (click)="$event.stopPropagation()" [(ngModel)]="optionalColumns.deliveryName">Delivery name
        </mat-checkbox>
    </div>
    <div mat-menu-item>
        <mat-checkbox (click)="$event.stopPropagation()" [(ngModel)]="optionalColumns.invoicingName">Billing name
        </mat-checkbox>
    </div>
    <div mat-menu-item>
        <mat-checkbox (click)="$event.stopPropagation()" [(ngModel)]="optionalColumns.storeId">StoreReference
        </mat-checkbox>
    </div>
    <div mat-menu-item>
        <mat-checkbox (click)="$event.stopPropagation()" [(ngModel)]="optionalColumns.trackingNumber">Tracking number
        </mat-checkbox>
    </div>
    <div mat-menu-item>
        <mat-checkbox (click)="$event.stopPropagation()" [(ngModel)]="optionalColumns.imported">Acknowledged
        </mat-checkbox>
    </div>
</mat-menu>

<mat-menu #printMenu="matMenu">
    <button mat-menu-item (click)="printPdf()" i18n>Invoices</button>
    <a mat-menu-item *ngFor="let exp of exports" sfLegacyLink
       [path]="'/Marketplaces/exportOrder?'+getExportParams(exp)">{{exp.name}}
    </a>
</mat-menu>